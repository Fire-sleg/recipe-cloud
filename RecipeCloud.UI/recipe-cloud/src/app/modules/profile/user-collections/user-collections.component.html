<div class="collections-container">
  <div class="base-container">
    <div class="collections-section">
      <div class="section-header">
        <h2 class="section-title">
          <span class="section-icon">üìö</span>
          –ú–æ—ó –∫–æ–ª–µ–∫—Ü—ñ—ó —Ä–µ—Ü–µ–ø—Ç—ñ–≤
        </h2>
        <p class="section-description">–û—Ä–≥–∞–Ω—ñ–∑—É–π—Ç–µ —É–ª—é–±–ª–µ–Ω—ñ —Ä–µ—Ü–µ–ø—Ç–∏ —É —Ç–µ–º–∞—Ç–∏—á–Ω—ñ –∫–æ–ª–µ–∫—Ü—ñ—ó</p>
        <button 
          type="button" 
          class="btn btn-create-collection" 
          (click)="createNewCollection()">
          <i class="fas fa-plus"></i>
          –°—Ç–≤–æ—Ä–∏—Ç–∏ –∫–æ–ª–µ–∫—Ü—ñ—é
        </button>
      </div>

      <div class="collections-grid" *ngIf="collections$ | async as collections; else emptyState">
        <div class="collection-card" *ngFor="let collection of collections; trackBy: trackByCollectionId">
          <div class="collection-header">
            <h3 class="collection-name">{{ collection.title }}</h3>
            <div class="collection-meta">
              <span class="recipe-count">üìù {{ collection.recipes.length }} —Ä–µ—Ü–µ–ø—Ç—ñ–≤</span>
              <div class="collection-actions">
                <button class="action-btn small edit" (click)="editCollection(collection)" title="–†–µ–¥–∞–≥—É–≤–∞—Ç–∏">‚úèÔ∏è</button>
                <button class="action-btn small delete" (click)="onDeleteCollection(collection.id)" title="–í–∏–¥–∞–ª–∏—Ç–∏">üóëÔ∏è</button>
              </div>
            </div>
          </div>

          <!-- –ó–∞–≥–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –Ω—É—Ç—Ä—ñ—î–Ω—Ç–∏ –∫–æ–ª–µ–∫—Ü—ñ—ó -->
          <div class="collection-nutrition" *ngIf="collection.recipes.length > 0">
            <h4 class="nutrition-title">üìä –ó–∞–≥–∞–ª—å–Ω–∞ –ø–æ–∂–∏–≤–Ω—ñ—Å—Ç—å –∫–æ–ª–µ–∫—Ü—ñ—ó</h4>
            <div class="nutrition-grid">
              <div class="nutrition-item">
                <span class="nutrition-icon">üî•</span>
                <span class="nutrition-value">{{ collection.totalCalories }}</span>
                <span class="nutrition-label">–∫–∫–∞–ª</span>
              </div>
              <div class="nutrition-item">
                <span class="nutrition-icon">ü•©</span>
                <span class="nutrition-value">{{ collection.totalProtein }}–≥</span>
                <span class="nutrition-label">–±—ñ–ª–∫–∏</span>
              </div>
              <div class="nutrition-item">
                <span class="nutrition-icon">üßà</span>
                <span class="nutrition-value">{{ collection.totalFat }}–≥</span>
                <span class="nutrition-label">–∂–∏—Ä–∏</span>
              </div>
              <div class="nutrition-item">
                <span class="nutrition-icon">üçû</span>
                <span class="nutrition-value">{{ collection.totalCarbohydrates }}–≥</span>
                <span class="nutrition-label">–≤—É–≥–ª–µ–≤.</span>
              </div>
            </div>
          </div>

          <div class="collection-recipes">
            <div class="collection-recipe" *ngFor="let recipe of collection.recipes; trackBy: trackByRecipeId">
              <div class="recipe-thumb">üçù</div>
              <div class="recipe-details">
                <h4 class="recipe-title">{{ recipe.title }}</h4>
                <div class="recipe-info">
                  <p class="recipe-time">‚è±Ô∏è {{ recipe.cookingTime }} —Ö–≤</p>
                  <!-- –ù—É—Ç—Ä—ñ—î–Ω—Ç–∏ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ —Ä–µ—Ü–µ–ø—Ç–∞ -->
                  <div class="recipe-nutrition" >
                    <span class="nutrition-mini">üî•{{ recipe.calories || 0 }}</span>
                    <span class="nutrition-mini">ü•©{{ recipe.protein || 0 }}–≥</span>
                    <span class="nutrition-mini">üßà{{ recipe.fat || 0 }}–≥</span>
                    <span class="nutrition-mini">üçû{{ recipe.carbohydrates || 0 }}–≥</span>
                  </div>
                </div>
              </div>
              <button class="remove-recipe-btn" (click)="removeFromCollection(collection.id, recipe.id!)" title="–í–∏–¥–∞–ª–∏—Ç–∏ –∑ –∫–æ–ª–µ–∫—Ü—ñ—ó">‚ùå</button>
            </div>
          </div>

          <div class="collection-footer">
            <button class="add-recipe-btn" (click)="openRecipeSelector(collection.id)">
              ‚ûï –î–æ–¥–∞—Ç–∏ —Ä–µ—Ü–µ–ø—Ç
            </button>
          </div>
        </div>
      </div>
      <ng-template #emptyState>
        <div class="empty-state">
          <div class="empty-icon">üìö</div>
          <h3>–£ –≤–∞—Å –ø–æ–∫–∏ —â–æ –Ω–µ–º–∞—î —Å—Ç–≤–æ—Ä–µ–Ω–∏—Ö –∫–æ–ª–µ–∫—Ü—ñ–π</h3>
          <p>–û—Ä–≥–∞–Ω—ñ–∑—É–π—Ç–µ —É–ª—é–±–ª–µ–Ω—ñ —Ä–µ—Ü–µ–ø—Ç–∏ —É —Ç–µ–º–∞—Ç–∏—á–Ω—ñ –∫–æ–ª–µ–∫—Ü—ñ—ó!</p>
          <button class="create-collection-btn" (click)="createNewCollection()">
            <span>‚ûï</span> –°—Ç–≤–æ—Ä–∏—Ç–∏ –∫–æ–ª–µ–∫—Ü—ñ—é
          </button>
        </div>
      </ng-template>
    </div>
    <app-collection-form
      [collectionToEdit]="selectedCollection"
      (collectionCreated)="onCollectionCreated($event)"
      (collectionUpdated)="onCollectionUpdated($event)"
      (formClosed)="onFormClosed()">
    </app-collection-form>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è –ø–æ—à—É–∫—É —Ç–∞ –≤–∏–±–æ—Ä—É —Ä–µ—Ü–µ–ø—Ç—ñ–≤ -->
<div class="modal" *ngIf="showAddModal" [class.active]="showAddModal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>–î–æ–¥–∞—Ç–∏ —Ä–µ—Ü–µ–ø—Ç –¥–æ –∫–æ–ª–µ–∫—Ü—ñ—ó</h3>
      <button class="close-btn" (click)="closeRecipeSelector()">‚úñ</button>
    </div>
    <div class="modal-body">
      <input
        type="text"
        [(ngModel)]="filters.name"
        (input)="onSearchInput()"
        placeholder="–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É —Ä–µ—Ü–µ–ø—Ç–∞..."
        class="search-input"
        autofocus
      />
      <div class="search-results" *ngIf="filteredRecipes.length > 0">
        <div
          class="recipe-result"
          *ngFor="let recipe of filteredRecipes; trackBy: trackByRecipeId"
          (click)="addRecipeToCollection(recipe.id!)"
        >
          <div class="recipe-thumb">üçΩÔ∏è</div>
          <div class="recipe-details">
            <h4>{{ recipe.title }}</h4>
            <div class="recipe-result-info">
              <p>‚è±Ô∏è {{ recipe.cookingTime }} —Ö–≤</p>
              <!-- –ù—É—Ç—Ä—ñ—î–Ω—Ç–∏ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö –ø–æ—à—É–∫—É -->
              <div class="recipe-nutrition" >
                <span class="nutrition-mini">üî•{{ recipe.calories || 0 }}</span>
                <span class="nutrition-mini">ü•©{{ recipe.protein || 0 }}–≥</span>
                <span class="nutrition-mini">üßà{{ recipe.fat || 0 }}–≥</span>
                <span class="nutrition-mini">üçû{{ recipe.carbohydrates || 0 }}–≥</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="no-results" *ngIf="showNotFound && filters.name">
        <p>–†–µ—Ü–µ–ø—Ç—ñ–≤ –∑–∞ –∑–∞–ø–∏—Ç–æ–º "{{ filters.name }}" –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ üòî</p>
      </div>
    </div>
  </div>
</div>