<!-- Create Collection Button -->
<div class="create-collection-section" *ngIf="isAuthenticated">
  <button 
    type="button" 
    class="btn btn-create-collection" 
    (click)="showCreateForm()"
    *ngIf="!showForm">
    <i class="fas fa-plus"></i>
    Створити колекцію
  </button>
</div>

<!-- Create Collection Form Modal -->
<div class="collection-form-overlay" *ngIf="showForm" (click)="hideCreateForm()">
  <div class="collection-form-container" (click)="$event.stopPropagation()">
    <div class="collection-form-header">
      <h2>Створити нову колекцію</h2>
      <button type="button" class="btn-close" (click)="hideCreateForm()">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <form [formGroup]="collectionForm" (ngSubmit)="onSubmit()" class="collection-form">
      <!-- Basic Information -->
      <div class="form-section">
        <h3>Основна інформація</h3>
        
        <div class="form-group">
          <label for="title">Назва колекції *</label>
          <input 
            type="text" 
            id="title" 
            formControlName="title" 
            class="form-control"
            [class.is-invalid]="isFieldInvalid('title')"
            placeholder="Введіть назву колекції">
          <div class="invalid-feedback" *ngIf="isFieldInvalid('title')">
            {{ getFieldError('title') }}
          </div>
        </div>

        <!-- <div class="form-group">
          <label for="description">Опис *</label>
          <textarea 
            id="description" 
            formControlName="description" 
            class="form-control"
            [class.is-invalid]="isFieldInvalid('description')"
            rows="3"
            placeholder="Опишіть вашу колекцію..."></textarea>
          <div class="invalid-feedback" *ngIf="isFieldInvalid('description')">
            {{ getFieldError('description') }}
          </div>
        </div> -->

      </div>

      <!-- Recipes Selection -->
      <div class="form-section">
        <h3>Рецепти в колекції</h3>
        
        <div formArrayName="recipes">
          <div *ngFor="let recipe of recipes.controls; let i = index" 
               [formGroupName]="i" 
               class="recipe-row">
            <div class="form-row">
              <div class="form-group">
                <select 
                  formControlName="recipeId" 
                  class="form-control"
                  [class.is-invalid]="isFieldInvalid('recipes.' + i + '.recipeId')">
                  <option value="">-- Оберіть рецепт --</option>
                  <option *ngFor="let recipe of availableRecipes" [value]="recipe.id">
                    {{ recipe.title }}
                  </option>
                </select>
                <div class="invalid-feedback" *ngIf="isFieldInvalid('recipes.' + i + '.recipeId')">
                  {{ getFieldError('recipes.' + i + '.recipeId') }}
                </div>
              </div>
              <button 
                type="button" 
                class="btn btn-remove"
                (click)="removeRecipe(i)"
                [disabled]="recipes.length === 1">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>
        </div>
        
        <button type="button" class="btn btn-add" (click)="addRecipe()">
          <i class="fas fa-plus"></i>
          Додати рецепт
        </button>
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <button type="button" class="btn btn-cancel" (click)="hideCreateForm()">
          Скасувати
        </button>
        <button 
          type="submit" 
          class="btn btn-submit"
          [disabled]="collectionForm.invalid || isSubmitting">
          <span *ngIf="isSubmitting">
            <i class="fas fa-spinner fa-spin"></i>
            Створення...
          </span>
          <span *ngIf="!isSubmitting">
            Створити колекцію
          </span>
        </button>
      </div>
    </form>
  </div>
</div>